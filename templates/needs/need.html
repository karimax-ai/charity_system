<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø² | Ø®ÛŒØ±ÛŒÙ‡â€ŒØ¢Ù†Ù„Ø§ÛŒÙ†</title>

    <!-- Bootstrap 5 RTL -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css">

    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Vazir Font -->
    <link href="https://cdn.fontcdn.ir/Font/Persian/Vazir/Vazir.css" rel="stylesheet">

    <!-- AOS Animation -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <!-- Toastify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

    <!-- Persian Datepicker -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/shahtheme/persian-datepicker@1.2.0/dist/css/persian-datepicker.min.css">

    <style>
        :root {
            --primary-deep: #0a2c3d;
            --primary-soft: #1e4a5f;
            --primary-gradient: linear-gradient(145deg, #0a2c3d, #1e4a5f);
            --accent-gold: #e6b31e;
            --accent-gold-soft: rgba(230, 179, 30, 0.12);
            --accent-gold-gradient: linear-gradient(135deg, #e6b31e, #ffd166);
            --accent-orange: #ff8a5c;
            --accent-orange-soft: rgba(255, 138, 92, 0.12);
            --accent-teal: #2a9d8f;
            --accent-teal-soft: rgba(42, 157, 143, 0.12);
            --accent-purple: #6c5ce7;
            --accent-purple-soft: rgba(108, 92, 231, 0.12);
            --accent-red: #e63946;
            --accent-red-soft: rgba(230, 57, 70, 0.12);
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-600: #475569;
            --gray-900: #0f172a;
            --shadow-sm: 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-md: 0 12px 16px -4px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 24px -6px rgba(0,0,0,0.08);
            --shadow-xl: 0 32px 48px -12px rgba(0,0,0,0.12);
            --shadow-gold: 0 12px 24px -8px rgba(230,179,30,0.24);
            --radius-sm: 10px;
            --radius-md: 14px;
            --radius-lg: 20px;
            --radius-xl: 28px;
            --radius-full: 9999px;
            --font-primary: 'Vazir', sans-serif;
            --transition-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
            --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: var(--font-primary);
        }

        body {
            background-color: var(--gray-50);
            overflow-x: hidden;
            color: var(--gray-900);
            line-height: 1.6;
        }

        /* ===== Ø§Ø³Ú©Ø±ÙˆÙ„Ø¨Ø§Ø± Ø³ÙØ§Ø±Ø´ÛŒ ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track { background: var(--gray-100); border-radius: var(--radius-full); }
        ::-webkit-scrollbar-thumb { background: var(--gray-600); border-radius: var(--radius-full); }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary-deep); }

        /* ===== Header Styles ===== */
        .main-header {
            background: white;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 1050;
            padding: 16px 0;
        }

        .brand-logo {
            width: 48px;
            height: 48px;
            background: var(--accent-gold-gradient);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            color: var(--primary-deep);
            box-shadow: var(--shadow-gold);
        }

        .nav-link-custom {
            font-weight: 600;
            color: var(--gray-900);
            padding: 10px 16px !important;
            border-radius: var(--radius-full);
            transition: all 0.3s;
        }

        .nav-link-custom:hover,
        .nav-link-custom.active {
            background: var(--accent-gold-soft);
            color: var(--primary-deep);
        }

        .nav-link-custom.active {
            position: relative;
        }

        .nav-link-custom.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 50%;
            transform: translateX(50%);
            width: 24px;
            height: 3px;
            background: var(--accent-gold);
            border-radius: var(--radius-full);
        }

        /* ===== Filter Section ===== */
        .filter-section {
            background: white;
            border-radius: var(--radius-xl);
            padding: 32px;
            box-shadow: var(--shadow-xl);
            margin-bottom: 32px;
            border: 1px solid var(--gray-200);
        }

        .filter-title {
            font-weight: 700;
            color: var(--primary-deep);
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
        }

        .filter-group {
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--gray-200);
        }

        .filter-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-600);
            margin-bottom: 8px;
            display: block;
            letter-spacing: 0.5px;
        }

        .form-control, .form-select, .input-group-text {
            border-radius: var(--radius-md);
            border: 1.5px solid var(--gray-200);
            padding: 12px 16px;
            transition: all 0.2s;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent-gold);
            box-shadow: 0 0 0 4px var(--accent-gold-soft);
        }

        /* ===== Need Card ===== */
        .need-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            transition: all 0.4s var(--transition-bounce);
            border: 1px solid var(--gray-200);
            height: 100%;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .need-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-xl);
            border-color: transparent;
        }

        .urgent-badge {
            position: absolute;
            top: 16px;
            left: 16px;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 6px 16px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 700;
            animation: pulse 2s infinite;
            z-index: 2;
        }

        .emergency-badge {
            background: linear-gradient(135deg, #7f1d1d, #991b1b);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
        }

        .verification-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 12px 0;
        }

        .verified-badge {
            background: var(--accent-teal);
            color: white;
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .verified-badge-pending {
            background: #f59e0b;
            color: white;
        }

        .verified-badge-multiple {
            background: var(--accent-purple);
            color: white;
        }

        .need-progress {
            margin: 16px 0;
        }

        .progress-custom {
            height: 10px;
            background: var(--gray-200);
            border-radius: var(--radius-full);
            overflow: hidden;
        }

        .progress-bar-custom {
            background: var(--primary-gradient);
            border-radius: var(--radius-full);
            transition: width 0.6s ease;
            height: 100%;
        }

        .need-amount {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary-deep);
        }

        .days-remaining {
            background: var(--gray-100);
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gray-600);
        }

        .days-remaining.urgent {
            background: var(--accent-red-soft);
            color: var(--accent-red);
        }

        .category-badge {
            background: var(--gray-100);
            padding: 4px 12px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-600);
        }

        /* ===== Search Suggestions ===== */
        .suggestions-container {
            position: absolute;
            width: 100%;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--gray-200);
            z-index: 1060;
            margin-top: 4px;
        }

        .suggestion-item {
            padding: 12px 16px;
            transition: all 0.2s;
            cursor: pointer;
            border-bottom: 1px solid var(--gray-200);
        }

        .suggestion-item:hover {
            background: var(--accent-gold-soft);
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        /* ===== Pagination ===== */
        .pagination-custom {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 48px;
            margin-bottom: 24px;
        }

        .page-item-custom {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            background: white;
            border: 1px solid var(--gray-200);
            color: var(--gray-600);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-item-custom:hover:not(.disabled) {
            background: var(--accent-gold-soft);
            border-color: var(--accent-gold);
            color: var(--primary-deep);
        }

        .page-item-custom.active {
            background: var(--primary-gradient);
            color: white;
            border-color: transparent;
        }

        .page-item-custom.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* ===== Skeleton Loading ===== */
        .skeleton {
            background: linear-gradient(90deg, var(--gray-200) 25%, var(--gray-100) 50%, var(--gray-200) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: var(--radius-sm);
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* ===== View Toggle ===== */
        .view-toggle {
            display: flex;
            gap: 4px;
            background: var(--gray-100);
            padding: 4px;
            border-radius: var(--radius-full);
        }

        .view-toggle-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            background: transparent;
            border: none;
            color: var(--gray-600);
            transition: all 0.2s;
        }

        .view-toggle-btn.active {
            background: white;
            color: var(--primary-deep);
            box-shadow: var(--shadow-sm);
        }

        /* ===== Empty State ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
        }

        .empty-state-icon {
            font-size: 4rem;
            color: var(--gray-300);
            margin-bottom: 20px;
        }

        /* ===== Animations ===== */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239,68,68,0.5); }
            70% { box-shadow: 0 0 0 10px rgba(239,68,68,0); }
            100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s var(--transition-smooth);
        }

        /* ===== List View ===== */
        .need-list-item {
            background: white;
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid var(--gray-200);
            transition: all 0.3s;
        }

        .need-list-item:hover {
            transform: translateX(-4px);
            box-shadow: var(--shadow-md);
            border-color: transparent;
        }

        /* ===== Responsive ===== */
        @media (max-width: 992px) {
            .filter-section { padding: 24px; }
            .need-card { padding: 20px; }
        }

        @media (max-width: 768px) {
            .filter-section { padding: 20px; }
            .hero-stats { flex-direction: column; }
        }
    </style>
</head>
<body>

<!-- ===== Header ===== -->
<header class="main-header">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid px-0">
                <a class="navbar-brand d-flex align-items-center gap-2" href="/">
                    <div class="brand-logo">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <span class="fw-bold fs-3" style="color: var(--primary-deep);">Ø®ÛŒØ±ÛŒÙ‡â€ŒØ¢Ù†Ù„Ø§ÛŒÙ†</span>
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarMain">
                    <ul class="navbar-nav mx-auto">
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/">ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom active" href="/needs">Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/shop">ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø®ÛŒØ±ÛŒÙ‡</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/charities">Ø®ÛŒØ±ÛŒÙ‡â€ŒÙ‡Ø§</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link nav-link-custom" href="/reports">Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ</a>
                        </li>
                    </ul>

                    <div class="d-flex gap-2">
                        <button class="btn btn-outline-gold rounded-pill px-4" onclick="showLoginModal()">
                            <i class="fas fa-sign-in-alt ms-2"></i> ÙˆØ±ÙˆØ¯
                        </button>
                        <button class="btn btn-register rounded-pill px-4" onclick="window.location.href='/register'">
                            Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… <i class="fas fa-arrow-left ms-2"></i>
                        </button>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>

<!-- ===== Main Content ===== -->
<main class="container py-4">
    <!-- ===== Breadcrumb ===== -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="/" class="text-decoration-none text-muted">Ø®Ø§Ù†Ù‡</a></li>
            <li class="breadcrumb-item active" aria-current="page">Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²</li>
        </ol>
    </nav>

    <!-- ===== Page Title & Stats ===== -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-4">
        <div>
            <h1 class="fw-bold" style="color: var(--primary-deep);">
                <i class="fas fa-clipboard-list ms-2" style="color: var(--accent-gold);"></i>
                Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²
            </h1>
            <p class="text-muted">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ùˆ Ø¬Ø³ØªØ¬ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù†ÛŒØ§Ø²Ù…Ù†Ø¯Ø§Ù† ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡</p>
        </div>
        <div class="d-flex gap-2">
            <span class="badge bg-success px-4 py-2" id="activeNeedsCount">
                <i class="fas fa-check-circle ms-1"></i>
                Û±Û²Û´ Ø¢Ú¯Ù‡ÛŒ ÙØ¹Ø§Ù„
            </span>
            <span class="badge bg-danger px-4 py-2" id="emergencyNeedsCount">
                <i class="fas fa-exclamation-circle ms-1"></i>
                Û¸ Ø¢Ú¯Ù‡ÛŒ ÙÙˆØ±ÛŒ
            </span>
        </div>
    </div>

    <!-- ===== ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ===== -->
    <div class="filter-section" data-aos="fade-up">
        <div class="filter-title">
            <i class="fas fa-sliders-h" style="color: var(--accent-gold);"></i>
            ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
        </div>

        <!-- Ø±Ø¯ÛŒÙ Ø§ÙˆÙ„: ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ø§ØµÙ„ÛŒ -->
        <div class="row g-3 mb-4">
            <div class="col-lg-4">
                <label class="filter-label">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§</label>
                <div class="input-group">
                    <span class="input-group-text bg-white border-end-0">
                        <i class="fas fa-search text-muted"></i>
                    </span>
                    <input type="text" class="form-control border-start-0" id="searchInput"
                           placeholder="Ø¹Ù†ÙˆØ§Ù†ØŒ ØªÙˆØ¶ÛŒØ­Ø§ØªØŒ Ú©Ø¯ Ø¢Ú¯Ù‡ÛŒ..."
                           autocomplete="off"
                           onkeyup="handleSearchKeyup(event)">
                </div>
                <div id="searchSuggestions" class="suggestions-container" style="display: none;"></div>
            </div>
            <div class="col-lg-2">
                <label class="filter-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                <select class="form-select" id="categoryFilter" onchange="applyFilters()">
                    <option value="">Ù‡Ù…Ù‡ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§</option>
                    <option value="educational">ğŸ“š Ø¢Ù…ÙˆØ²Ø´ÛŒ</option>
                    <option value="health">ğŸ¥ Ø¨Ù‡Ø¯Ø§Ø´ØªÛŒ/Ø¯Ø±Ù…Ø§Ù†ÛŒ</option>
                    <option value="livelihood">ğŸ Ù…Ø¹ÛŒØ´ØªÛŒ</option>
                    <option value="dowry">ğŸ’ Ø¬Ù‡ÛŒØ²ÛŒÙ‡</option>
                    <option value="housing">ğŸ  Ù…Ø³Ú©Ù†</option>
                    <option value="emergency">ğŸš¨ ÙÙˆØ±ÛŒ/Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</option>
                </select>
            </div>
            <div class="col-lg-2">
                <label class="filter-label">Ø§Ø³ØªØ§Ù†</label>
                <select class="form-select" id="provinceFilter" onchange="applyFilters()">
                    <option value="">Ù‡Ù…Ù‡ Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§</option>
                </select>
            </div>
            <div class="col-lg-2">
                <label class="filter-label">Ø®ÛŒØ±ÛŒÙ‡</label>
                <select class="form-select" id="charityFilter" onchange="applyFilters()">
                    <option value="">Ù‡Ù…Ù‡ Ø®ÛŒØ±ÛŒÙ‡â€ŒÙ‡Ø§</option>
                </select>
            </div>
            <div class="col-lg-2">
                <label class="filter-label">Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ</label>
                <select class="form-select" id="sortFilter" onchange="applyFilters()">
                    <option value="created_at.desc">ğŸ†• Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                    <option value="collected_amount.desc">ğŸ’° Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù¾ÛŒØ´Ø±ÙØª</option>
                    <option value="target_amount.desc">ğŸ¯ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ù‡Ø¯Ù</option>
                    <option value="deadline.asc">â° Ù†Ø²Ø¯ÛŒÚ©â€ŒØªØ±ÛŒÙ† Ù…Ù‡Ù„Øª</option>
                    <option value="view_count.desc">ğŸ‘ Ù¾Ø±Ø¨Ø§Ø²Ø¯ÛŒØ¯ØªØ±ÛŒÙ†</option>
                    <option value="donation_count.desc">ğŸ¤ Ø¨ÛŒØ´ØªØ±ÛŒÙ† Ú©Ù…Ú©</option>
                </select>
            </div>
        </div>

        <!-- Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ…: ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ (Ú©ÙˆÙ„Ø§Ù¾Ø³) -->
        <div class="collapse" id="advancedFilters">
            <div class="filter-group">
                <div class="row g-3">
                    <div class="col-lg-3 col-md-6">
                        <label class="filter-label">Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)</label>
                        <div class="d-flex gap-2">
                            <input type="number" class="form-control" id="minAmount"
                                   placeholder="Ø§Ø²" onchange="applyFilters()">
                            <input type="number" class="form-control" id="maxAmount"
                                   placeholder="ØªØ§" onchange="applyFilters()">
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="filter-label">ÙˆØ¶Ø¹ÛŒØª</label>
                        <select class="form-select" id="statusFilter" onchange="applyFilters()">
                            <option value="">Ù‡Ù…Ù‡ ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§</option>
                            <option value="active">ğŸŸ¢ ÙØ¹Ø§Ù„</option>
                            <option value="pending">â³ Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</option>
                            <option value="approved">âœ… ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡</option>
                            <option value="completed">ğŸ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</option>
                            <option value="rejected">âŒ Ø±Ø¯ Ø´Ø¯Ù‡</option>
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="filter-label">ÙÙˆØ±ÛŒØª</label>
                        <select class="form-select" id="urgencyFilter" onchange="applyFilters()">
                            <option value="">Ù‡Ù…Ù‡</option>
                            <option value="urgent">ğŸ”´ ÙÙˆØ±ÛŒ</option>
                            <option value="emergency">ğŸš¨ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ</option>
                        </select>
                    </div>
                    <div class="col-lg-2 col-md-6">
                        <label class="filter-label">ØªØ£ÛŒÛŒØ¯ÛŒÙ‡â€ŒÙ‡Ø§</label>
                        <select class="form-select" id="verifiedFilter" onchange="applyFilters()">
                            <option value="">Ù‡Ù…Ù‡</option>
                            <option value="true">âœ… Ø¯Ø§Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ÛŒÙ‡</option>
                            <option value="false">âŒ Ø¨Ø¯ÙˆÙ† ØªØ£ÛŒÛŒØ¯ÛŒÙ‡</option>
                        </select>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <label class="filter-label">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</label>
                        <div class="d-flex gap-2">
                            <input type="text" class="form-control datepicker" id="dateFrom"
                                   placeholder="Ø§Ø² ØªØ§Ø±ÛŒØ®" onchange="applyFilters()">
                            <input type="text" class="form-control datepicker" id="dateTo"
                                   placeholder="ØªØ§ ØªØ§Ø±ÛŒØ®" onchange="applyFilters()">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¹Ù…Ù„ÛŒØ§Øª -->
        <div class="d-flex flex-wrap justify-content-between align-items-center mt-3">
            <div>
                <button class="btn btn-link text-decoration-none" type="button"
                        data-bs-toggle="collapse" data-bs-target="#advancedFilters" id="advancedFiltersBtn">
                    <i class="fas fa-chevron-down ms-1"></i>
                    ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
                </button>
                <button class="btn btn-link text-decoration-none" onclick="resetFilters()">
                    <i class="fas fa-redo-alt ms-1"></i>
                    Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ
                </button>
            </div>
            <div class="d-flex gap-2">
                <button class="btn btn-outline-gold rounded-pill px-4" onclick="applyFilters()">
                    <i class="fas fa-filter ms-2"></i>
                    Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±
                </button>
                <button class="btn btn-outline-secondary rounded-pill px-4" onclick="saveSearchFilter()">
                    <i class="fas fa-save ms-2"></i>
                    Ø°Ø®ÛŒØ±Ù‡ Ø¬Ø³ØªØ¬Ùˆ
                </button>
            </div>
        </div>
    </div>

    <!-- ===== Ù†ØªØ§ÛŒØ¬ Ùˆ Ù†Ù…Ø§ÛŒØ´ ===== -->
    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
        <div class="d-flex align-items-center gap-3">
            <span class="fw-bold fs-5" id="resultsCount">Û±Û²Û´</span>
            <span class="text-muted">Ø¢Ú¯Ù‡ÛŒ ÛŒØ§ÙØª Ø´Ø¯</span>
            <span class="badge bg-light text-dark px-3 py-2" id="activeFiltersBadge" style="display: none;">
                <i class="fas fa-filter ms-1"></i>
                <span id="activeFiltersCount">Û°</span> ÙÛŒÙ„ØªØ± ÙØ¹Ø§Ù„
            </span>
        </div>
        <div class="d-flex align-items-center gap-3">
            <div class="view-toggle">
                <button class="view-toggle-btn active" onclick="toggleViewMode('grid')" title="Ù†Ù…Ø§ÛŒØ´ Ú©Ø§Ø±ØªÛŒ">
                    <i class="fas fa-grid-2"></i>
                </button>
                <button class="view-toggle-btn" onclick="toggleViewMode('list')" title="Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³ØªÛŒ">
                    <i class="fas fa-list"></i>
                </button>
            </div>
            <select class="form-select form-select-sm" style="width: 150px;" id="pageSizeSelect" onchange="changePageSize()">
                <option value="12">Û±Û² Ø¹Ø¯Ø¯ Ø¯Ø± ØµÙØ­Ù‡</option>
                <option value="24">Û²Û´ Ø¹Ø¯Ø¯ Ø¯Ø± ØµÙØ­Ù‡</option>
                <option value="48">Û´Û¸ Ø¹Ø¯Ø¯ Ø¯Ø± ØµÙØ­Ù‡</option>
            </select>
        </div>
    </div>

    <!-- ===== Ù†Ù…Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ (Grid View) ===== -->
    <div class="row g-4" id="needsGridContainer">
        <!-- Ø§Ø³Ú©Ù„ØªÙˆÙ† Ù„ÙˆØ¯ÛŒÙ†Ú¯ -->
        <div class="col-lg-4 col-md-6 skeleton-loading">
            <div class="need-card">
                <div class="skeleton" style="height: 24px; width: 70%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 20px; width: 50%; margin-bottom: 12px;"></div>
                <div class="skeleton" style="height: 16px; width: 40%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 10px; width: 100%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 48px; width: 100%;"></div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 skeleton-loading">
            <div class="need-card">
                <div class="skeleton" style="height: 24px; width: 70%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 20px; width: 50%; margin-bottom: 12px;"></div>
                <div class="skeleton" style="height: 16px; width: 40%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 10px; width: 100%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 48px; width: 100%;"></div>
            </div>
        </div>
        <div class="col-lg-4 col-md-6 skeleton-loading">
            <div class="need-card">
                <div class="skeleton" style="height: 24px; width: 70%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 20px; width: 50%; margin-bottom: 12px;"></div>
                <div class="skeleton" style="height: 16px; width: 40%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 10px; width: 100%; margin-bottom: 16px;"></div>
                <div class="skeleton" style="height: 48px; width: 100%;"></div>
            </div>
        </div>
    </div>

    <!-- ===== Ù†Ù…Ø§ÛŒØ´ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ (List View - Ù…Ø®ÙÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§) ===== -->
    <div id="needsListContainer" style="display: none;"></div>

    <!-- ===== ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ ===== -->
    <div class="pagination-custom" id="pagination"></div>
</main>

<!-- ===== Ù…ÙˆØ¯Ø§Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø¬Ø³ØªØ¬Ùˆ ===== -->
<div class="modal fade" id="saveSearchModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: var(--radius-lg);">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-save ms-2" style="color: var(--accent-gold);"></i>
                    Ø°Ø®ÛŒØ±Ù‡ ÙÛŒÙ„ØªØ± Ø¬Ø³ØªØ¬Ùˆ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <div class="mb-3">
                    <label class="form-label fw-bold">Ù†Ø§Ù… ÙÛŒÙ„ØªØ±</label>
                    <input type="text" class="form-control" id="searchFilterName"
                           placeholder="Ù…Ø«Ø§Ù„: Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ ÙÙˆØ±ÛŒ ØªÙ‡Ø±Ø§Ù†">
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Ø§Ø¹Ù„Ø§Ù† Ø®ÙˆØ¯Ú©Ø§Ø±</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="autoNotify">
                        <label class="form-check-label" for="autoNotify">
                            Ø¨Ø±Ø§ÛŒ Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø§Ø¹Ù„Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
                        </label>
                    </div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">ÙØ±Ú©Ø§Ù†Ø³ Ø§Ø¹Ù„Ø§Ù†</label>
                    <select class="form-select" id="notifyFrequency" disabled>
                        <option value="instant">Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ</option>
                        <option value="daily">Ø±ÙˆØ²Ø§Ù†Ù‡</option>
                        <option value="weekly">Ù‡ÙØªÚ¯ÛŒ</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
                    Ø§Ù†ØµØ±Ø§Ù
                </button>
                <button type="button" class="btn btn-primary-charity rounded-pill px-4" onclick="saveSearchFilterSubmit()">
                    Ø°Ø®ÛŒØ±Ù‡ Ø¬Ø³ØªØ¬Ùˆ
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ===== Ù…ÙˆØ¯Ø§Ù„ ÙˆØ±ÙˆØ¯ ===== -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="border-radius: var(--radius-lg);">
            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-sign-in-alt ms-2" style="color: var(--accent-gold);"></i>
                    ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ù¾Ù†Ù„ Ú©Ø§Ø±Ø¨Ø±ÛŒ
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-4">
                <ul class="nav nav-pills mb-4 justify-content-center" id="loginTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="password-tab" data-bs-toggle="pill" data-bs-target="#password" type="button">
                            Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="otp-tab" data-bs-toggle="pill" data-bs-target="#otp" type="button">
                            Ù¾ÛŒØ§Ù…Ú© OTP
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="google-tab" data-bs-toggle="pill" data-bs-target="#google" type="button">
                            Ú¯ÙˆÚ¯Ù„
                        </button>
                    </li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade show active" id="password">
                        <form id="loginPasswordForm" onsubmit="handlePasswordLogin(event)">
                            <div class="mb-3">
                                <input type="email" class="form-control" placeholder="Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
                            </div>
                            <div class="mb-3">
                                <input type="password" class="form-control" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±">
                            </div>
                            <div class="mb-3 form-check">
                                <input type="checkbox" class="form-check-input" id="rememberMe">
                                <label class="form-check-label" for="rememberMe">Ù…Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø±</label>
                            </div>
                            <button type="submit" class="btn btn-primary-charity w-100 rounded-pill">
                                ÙˆØ±ÙˆØ¯
                            </button>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="otp">
                        <form id="loginOtpForm">
                            <div class="mb-3">
                                <input type="tel" class="form-control" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„">
                            </div>
                            <button type="button" class="btn btn-outline-gold w-100 rounded-pill" onclick="sendOtp()">
                                Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ£ÛŒÛŒØ¯
                            </button>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="google">
                        <button class="btn btn-outline-secondary w-100 rounded-pill" onclick="handleGoogleLogin()">
                            <i class="fab fa-google ms-2"></i>
                            ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ú¯ÙˆÚ¯Ù„
                        </button>
                    </div>
                </div>
                <div class="mt-4 text-center">
                    <span class="text-muted">Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ù‡Ø³ØªÛŒØ¯ØŸ</span>
                    <a href="/register" class="fw-bold" style="color: var(--accent-teal);">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script src="https://cdn.jsdelivr.net/gh/shahtheme/persian-datepicker@1.2.0/dist/js/persian-datepicker.min.js"></script>

<script>
    // ==================== Ú©Ø§Ù†ÙÛŒÚ¯ Axios ====================
    const api = axios.create({
        baseURL: '/api/v1',
        timeout: 15000,
        headers: { 'Content-Type': 'application/json' }
    });

    // ØªÙˆÚ©Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
    const authToken = localStorage.getItem('access_token');
    if (authToken) {
        api.defaults.headers.common['Authorization'] = `Bearer ${authToken}`;
    }

    // ==================== State Ù…Ø¯ÛŒØ±ÛŒØª ====================
    const state = {
        currentPage: 1,
        pageSize: 12,
        totalPages: 0,
        totalItems: 0,
        filters: {
            category: null,
            province: null,
            charity_id: null,
            is_urgent: null,
            is_emergency: null,
            min_amount: null,
            max_amount: null,
            verified_only: false,
            search_text: null,
            sort_by: 'created_at',
            sort_order: 'desc',
            status: null,
            start_date: null,
            end_date: null
        },
        viewMode: 'grid',
        charities: [],
        provinces: [],
        activeFiltersCount: 0,
        savedSearches: []
    };

    // ==================== 1ï¸âƒ£ Ù„ÛŒØ³Øª Ù†ÛŒØ§Ø²Ù‡Ø§ Ø¨Ø§ ÙÛŒÙ„ØªØ± ====================
    // GET /api/v1/needs/
    async function loadNeeds(page = 1) {
        showLoading();

        try {
            // Ø³Ø§Ø®Øª Ù¾Ø§Ø±Ø§Ù…ØªØ±Ù‡Ø§ÛŒ Ú©ÙˆØ¦Ø±ÛŒ
            const params = {
                page: page,
                limit: state.pageSize,
                sort_by: state.filters.sort_by,
                sort_order: state.filters.sort_order
            };

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§
            if (state.filters.category) params.category = state.filters.category;
            if (state.filters.province) params.province = state.filters.province;
            if (state.filters.charity_id) params.charity_id = state.filters.charity_id;
            if (state.filters.is_urgent) params.is_urgent = state.filters.is_urgent;
            if (state.filters.is_emergency) params.is_emergency = state.filters.is_emergency;
            if (state.filters.min_amount) params.min_amount = state.filters.min_amount;
            if (state.filters.max_amount) params.max_amount = state.filters.max_amount;
            if (state.filters.verified_only) params.verified_only = true;
            if (state.filters.search_text) params.search_text = state.filters.search_text;
            if (state.filters.status) params.status = state.filters.status;
            if (state.filters.start_date) params.start_date = state.filters.start_date;
            if (state.filters.end_date) params.end_date = state.filters.end_date;

            // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¨Ù‡ API
            // const response = await api.get('/needs/', { params });
            // const data = response.data;

            // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´
            const data = {
                items: [
                    {
                        id: 1,
                        title: 'Ú©Ù…Ú© ÙÙˆØ±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¹Ù…Ù„ Ù‚Ù„Ø¨',
                        charity_name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø§Ù…Ø§Ù… Ø±Ø¶Ø§ (Ø¹)',
                        category: 'health',
                        province: 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ',
                        city: 'Ù…Ø´Ù‡Ø¯',
                        target_amount: 50000000,
                        collected_amount: 18500000,
                        percentage: 37,
                        is_urgent: false,
                        is_emergency: true,
                        verified_by: ['Ø®ÛŒØ±ÛŒÙ‡ Ø§Ù…Ø§Ù… Ø±Ø¶Ø§', 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø´Ù‡ÛŒØ¯ Ø±Ø¬Ø§ÛŒÛŒ'],
                        days_left: 12,
                        view_count: 342,
                        donation_count: 28,
                        created_at: '2025-01-15T10:30:00Z'
                    },
                    {
                        id: 2,
                        title: 'Ø¬Ù‡ÛŒØ²ÛŒÙ‡ Ù†ÙˆØ¹Ø±ÙˆØ³Ø§Ù†',
                        charity_name: 'Ø®ÛŒØ±ÛŒÙ‡ Ù†ÙˆØ±Ø§Ù„Ù‡Ø¯ÛŒ',
                        category: 'dowry',
                        province: 'Ø§ØµÙÙ‡Ø§Ù†',
                        city: 'Ø§ØµÙÙ‡Ø§Ù†',
                        target_amount: 30000000,
                        collected_amount: 28500000,
                        percentage: 95,
                        is_urgent: true,
                        is_emergency: false,
                        verified_by: ['Ú©Ù…ÛŒØªÙ‡ Ø§Ù…Ø¯Ø§Ø¯'],
                        days_left: 5,
                        view_count: 521,
                        donation_count: 45,
                        created_at: '2025-01-20T14:20:00Z'
                    },
                    {
                        id: 3,
                        title: 'Ø®Ø±ÛŒØ¯ ÙˆÛŒÙ„Ú†Ø± Ø¨Ø±Ù‚ÛŒ',
                        charity_name: 'Ù…Ø¤Ø³Ø³Ù‡ Ù…Ù‡Ø± Ø³Ø¨Ø²',
                        category: 'health',
                        province: 'ØªÙ‡Ø±Ø§Ù†',
                        city: 'ØªÙ‡Ø±Ø§Ù†',
                        target_amount: 15000000,
                        collected_amount: 4200000,
                        percentage: 28,
                        is_urgent: false,
                        is_emergency: false,
                        verified_by: ['Ø¨Ù‡Ø²ÛŒØ³ØªÛŒ'],
                        days_left: 20,
                        view_count: 187,
                        donation_count: 12,
                        created_at: '2025-01-25T09:15:00Z'
                    },
                    {
                        id: 4,
                        title: 'Ú©Ù…Ú© Ù‡Ø²ÛŒÙ†Ù‡ ØªØ­ØµÛŒÙ„ÛŒ',
                        charity_name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø§Ù…Ø§Ù… Ø±Ø¶Ø§ (Ø¹)',
                        category: 'educational',
                        province: 'ÙØ§Ø±Ø³',
                        city: 'Ø´ÛŒØ±Ø§Ø²',
                        target_amount: 5000000,
                        collected_amount: 3200000,
                        percentage: 64,
                        is_urgent: false,
                        is_emergency: false,
                        verified_by: ['Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ù¾Ø±ÙˆØ±Ø´'],
                        days_left: 8,
                        view_count: 256,
                        donation_count: 31,
                        created_at: '2025-02-01T11:45:00Z'
                    },
                    {
                        id: 5,
                        title: 'ØªØ£Ù…ÛŒÙ† Ù…Ø³Ú©Ù† Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡',
                        charity_name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø­Ø¶Ø±Øª Ø¹Ù„ÛŒ (Ø¹)',
                        category: 'housing',
                        province: 'Ø®ÙˆØ²Ø³ØªØ§Ù†',
                        city: 'Ø§Ù‡ÙˆØ§Ø²',
                        target_amount: 80000000,
                        collected_amount: 12300000,
                        percentage: 15,
                        is_urgent: false,
                        is_emergency: false,
                        verified_by: [],
                        days_left: 45,
                        view_count: 98,
                        donation_count: 7,
                        created_at: '2025-01-10T08:30:00Z'
                    },
                    {
                        id: 6,
                        title: 'Ú©Ù…Ú© Ø¨Ù‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ø³Ø±Ø·Ø§Ù†ÛŒ',
                        charity_name: 'Ù…Ø¤Ø³Ø³Ù‡ Ù…Ù‡Ø± Ø³Ø¨Ø²',
                        category: 'health',
                        province: 'Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†',
                        city: 'Ø³Ø§Ø±ÛŒ',
                        target_amount: 12000000,
                        collected_amount: 9800000,
                        percentage: 82,
                        is_urgent: true,
                        is_emergency: false,
                        verified_by: ['Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§Ù…Ø§Ù… Ø®Ù…ÛŒÙ†ÛŒ'],
                        days_left: 3,
                        view_count: 412,
                        donation_count: 38,
                        created_at: '2025-02-05T16:20:00Z'
                    }
                ],
                total: 124,
                total_pages: 21,
                page: page,
                limit: state.pageSize
            };

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ state
            state.totalItems = data.total;
            state.totalPages = data.total_pages;
            state.currentPage = page;

            // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ UI
            updateResultsCount(data.total);
            updateActiveFiltersCount();

            if (state.viewMode === 'grid') {
                renderNeedsGrid(data.items);
            } else {
                renderNeedsList(data.items);
            }

            renderPagination(data.total_pages, page);

        } catch (error) {
            console.error('Error loading needs:', error);
            showNotification('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§', 'error');
        } finally {
            hideLoading();
        }
    }

    // ==================== 2ï¸âƒ£ Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø± Ù†ÛŒØ§Ø²Ù‡Ø§ ====================
    // GET /api/v1/needs/stats
    async function loadNeedsStats() {
        try {
            // const response = await api.get('/needs/stats');
            // const stats = response.data;

            // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
            document.getElementById('activeNeedsCount').innerHTML = `
                <i class="fas fa-check-circle ms-1"></i>
                Û±Û²Û´ Ø¢Ú¯Ù‡ÛŒ ÙØ¹Ø§Ù„
            `;
            document.getElementById('emergencyNeedsCount').innerHTML = `
                <i class="fas fa-exclamation-circle ms-1"></i>
                Û¸ Ø¢Ú¯Ù‡ÛŒ ÙÙˆØ±ÛŒ
            `;
        } catch (error) {
            console.error('Error loading stats:', error);
        }
    }

    // ==================== 3ï¸âƒ£ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¬Ø³ØªØ¬Ùˆ ====================
    // GET /api/v1/needs/search/suggestions?q=
    let searchTimeout;
    async function handleSearchKeyup(event) {
        const query = event.target.value.trim();

        clearTimeout(searchTimeout);

        if (query.length < 2) {
            document.getElementById('searchSuggestions').style.display = 'none';
            return;
        }

        searchTimeout = setTimeout(async () => {
            try {
                // const response = await api.get('/needs/search/suggestions', {
                //     params: { q: query, limit: 5 }
                // });
                // const suggestions = response.data.suggestions;

                // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
                const suggestions = [
                    { text: 'Ú©Ù…Ú© Ø¨Ù‡ Ø¨ÛŒÙ…Ø§Ø±Ø§Ù†', type: 'title' },
                    { text: 'ØªÙ‡Ø±Ø§Ù†', type: 'city' },
                    { text: 'Ø¢Ù…ÙˆØ²Ø´ÛŒ', type: 'category' },
                    { text: 'Ø¬Ù‡ÛŒØ²ÛŒÙ‡', type: 'category' },
                    { text: 'Ù…Ø´Ù‡Ø¯', type: 'city' }
                ].filter(s => s.text.includes(query) || s.text.includes(query));

                renderSearchSuggestions(suggestions);
            } catch (error) {
                console.error('Error fetching suggestions:', error);
            }
        }, 500);
    }

    function renderSearchSuggestions(suggestions) {
        const container = document.getElementById('searchSuggestions');

        if (!suggestions || suggestions.length === 0) {
            container.style.display = 'none';
            return;
        }

        let html = '';
        suggestions.forEach(s => {
            let icon = 'fa-search';
            let label = 'Ø¹Ù†ÙˆØ§Ù†';

            if (s.type === 'city') {
                icon = 'fa-city';
                label = 'Ø´Ù‡Ø±';
            } else if (s.type === 'category') {
                icon = 'fa-tag';
                label = 'Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ';
            }

            html += `
                <div class="suggestion-item d-flex align-items-center gap-3" onclick="selectSuggestion('${s.text}', '${s.type}')">
                    <i class="fas ${icon} text-muted"></i>
                    <span>${s.text}</span>
                    <small class="text-muted me-auto">${label}</small>
                </div>
            `;
        });

        container.innerHTML = html;
        container.style.display = 'block';
    }

    function selectSuggestion(text, type) {
        document.getElementById('searchInput').value = text;
        document.getElementById('searchSuggestions').style.display = 'none';

        if (type === 'city') {
            state.filters.province = text;
            document.getElementById('provinceFilter').value = text;
        } else if (type === 'category') {
            state.filters.category = text;
            document.getElementById('categoryFilter').value = text;
        } else {
            state.filters.search_text = text;
        }

        applyFilters();
    }

    // ==================== 4ï¸âƒ£ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø®ÛŒØ±ÛŒÙ‡â€ŒÙ‡Ø§ ====================
    // GET /api/v1/charities
    async function loadCharities() {
        try {
            // const response = await api.get('/charities', {
            //     params: { limit: 100, active_only: true }
            // });
            // state.charities = response.data.items || [];

            // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
            state.charities = [
                { id: 1, name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø§Ù…Ø§Ù… Ø±Ø¶Ø§ (Ø¹)' },
                { id: 2, name: 'Ù…Ø¤Ø³Ø³Ù‡ Ù…Ù‡Ø± Ø³Ø¨Ø²' },
                { id: 3, name: 'Ø®ÛŒØ±ÛŒÙ‡ Ù†ÙˆØ±Ø§Ù„Ù‡Ø¯ÛŒ' },
                { id: 4, name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø­Ø¶Ø±Øª Ø¹Ù„ÛŒ (Ø¹)' },
                { id: 5, name: 'Ø®ÛŒØ±ÛŒÙ‡ Ù…Ø­Ú©' }
            ];

            renderCharitiesFilter();
        } catch (error) {
            console.error('Error loading charities:', error);
        }
    }

    function renderCharitiesFilter() {
        const select = document.getElementById('charityFilter');
        select.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ø®ÛŒØ±ÛŒÙ‡â€ŒÙ‡Ø§</option>';

        state.charities.forEach(charity => {
            select.innerHTML += `<option value="${charity.id}">${charity.name}</option>`;
        });
    }

    // ==================== 5ï¸âƒ£ Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ ====================
    async function loadProvinces() {
        // Ø§ÛŒÙ† Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø§Ø² API Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¨ÛŒØ§Ø¯ ÛŒØ§ Ø§Ø² cache
        state.provinces = [
            'ØªÙ‡Ø±Ø§Ù†', 'Ø®Ø±Ø§Ø³Ø§Ù† Ø±Ø¶ÙˆÛŒ', 'Ø§ØµÙÙ‡Ø§Ù†', 'ÙØ§Ø±Ø³',
            'Ø®ÙˆØ²Ø³ØªØ§Ù†', 'Ø¢Ø°Ø±Ø¨Ø§ÛŒØ¬Ø§Ù† Ø´Ø±Ù‚ÛŒ', 'Ù…Ø§Ø²Ù†Ø¯Ø±Ø§Ù†', 'Ú¯ÛŒÙ„Ø§Ù†',
            'Ø§Ù„Ø¨Ø±Ø²', 'Ù‚Ù…', 'Ú©Ø±Ù…Ø§Ù†', 'ÛŒØ²Ø¯'
        ];

        const select = document.getElementById('provinceFilter');
        select.innerHTML = '<option value="">Ù‡Ù…Ù‡ Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§</option>';

        state.provinces.forEach(province => {
            select.innerHTML += `<option value="${province}">${province}</option>`;
        });
    }

    // ==================== 6ï¸âƒ£ ØªØ£ÛŒÛŒØ¯ÛŒÙ‡â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ù†ÛŒØ§Ø² ====================
    // GET /api/v1/needs/{need_id}/verifications
    async function loadNeedVerifications(needId) {
        try {
            // const response = await api.get(`/needs/${needId}/verifications`);
            // return response.data.verifications || [];

            // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
            const mockVerifications = {
                1: [
                    { charity_name: 'Ø®ÛŒØ±ÛŒÙ‡ Ø§Ù…Ø§Ù… Ø±Ø¶Ø§', status: 'approved', verified_at: '2025-01-20T10:30:00Z' },
                    { charity_name: 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø´Ù‡ÛŒØ¯ Ø±Ø¬Ø§ÛŒÛŒ', status: 'approved', verified_at: '2025-01-22T14:20:00Z' }
                ],
                2: [
                    { charity_name: 'Ú©Ù…ÛŒØªÙ‡ Ø§Ù…Ø¯Ø§Ø¯', status: 'approved', verified_at: '2025-01-25T09:15:00Z' }
                ],
                3: [
                    { charity_name: 'Ø¨Ù‡Ø²ÛŒØ³ØªÛŒ', status: 'approved', verified_at: '2025-01-28T11:45:00Z' }
                ],
                4: [
                    { charity_name: 'Ø¢Ù…ÙˆØ²Ø´ Ùˆ Ù¾Ø±ÙˆØ±Ø´', status: 'approved', verified_at: '2025-02-03T16:20:00Z' }
                ],
                6: [
                    { charity_name: 'Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ø§Ù…Ø§Ù… Ø®Ù…ÛŒÙ†ÛŒ', status: 'approved', verified_at: '2025-02-06T08:30:00Z' }
                ]
            };

            return mockVerifications[needId] || [];
        } catch (error) {
            console.error(`Error loading verifications for need ${needId}:`, error);
            return [];
        }
    }

    // ==================== 7ï¸âƒ£ Ø¢Ù…Ø§Ø± ÛŒÚ© Ù†ÛŒØ§Ø² ====================
    // GET /api/v1/needs/{need_id}/stats
    async function loadNeedStats(needId) {
        try {
            // const response = await api.get(`/needs/${needId}/stats`);
            // return response.data;

            // Ø¯ÛŒØªØ§ÛŒ Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
            const mockStats = {
                1: { progress_percentage: 37, days_remaining: 12, total_donations: 28, total_donated: 18500000 },
                2: { progress_percentage: 95, days_remaining: 5, total_donations: 45, total_donated: 28500000 },
                3: { progress_percentage: 28, days_remaining: 20, total_donations: 12, total_donated: 4200000 },
                4: { progress_percentage: 64, days_remaining: 8, total_donations: 31, total_donated: 3200000 },
                5: { progress_percentage: 15, days_remaining: 45, total_donations: 7, total_donated: 12300000 },
                6: { progress_percentage: 82, days_remaining: 3, total_donations: 38, total_donated: 9800000 }
            };

            return mockStats[needId] || {
                progress_percentage: 0,
                days_remaining: null,
                total_donations: 0,
                total_donated: 0
            };
        } catch (error) {
            console.error(`Error loading stats for need ${needId}:`, error);
            return null;
        }
    }

    // ==================== 8ï¸âƒ£ Ø±Ù†Ø¯Ø± Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ (Grid View) ====================
    async function renderNeedsGrid(needs) {
        const container = document.getElementById('needsGridContainer');

        if (!needs || needs.length === 0) {
            container.innerHTML = `
                <div class="col-12">
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <h5 class="fw-bold mb-2">Ø¢Ú¯Ù‡ÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h5>
                        <p class="text-muted">Ø¨Ø§ ØªØºÛŒÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯</p>
                        <button class="btn btn-outline-gold rounded-pill px-4 mt-3" onclick="resetFilters()">
                            <i class="fas fa-redo-alt ms-2"></i>
                            Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§
                        </button>
                    </div>
                </div>
            `;
            return;
        }

        let html = '';

        for (const need of needs) {
            // Ø¯Ø±ÛŒØ§ÙØª ØªØ£ÛŒÛŒØ¯ÛŒÙ‡â€ŒÙ‡Ø§
            const verifications = await loadNeedVerifications(need.id);
            const approvedVerifications = verifications.filter(v => v.status === 'approved');

            // Ø¯Ø±ÛŒØ§ÙØª Ø¢Ù…Ø§Ø±
            const stats = await loadNeedStats(need.id);

            // ØªØ¹ÛŒÛŒÙ† Ú©Ù„Ø§Ø³ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ù‡
            const daysClass = stats?.days_remaining <= 5 ? 'urgent' : '';

            html += `
                <div class="col-lg-4 col-md-6" data-aos="fade-up">
                    <div class="need-card">
                        ${need.is_emergency ? `
                            <span class="urgent-badge">
                                <i class="fas fa-exclamation-circle ms-1"></i> Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ
                            </span>
                        ` : need.is_urgent ? `
                            <span class="urgent-badge">
                                <i class="fas fa-clock ms-1"></i> ÙÙˆØ±ÛŒ
                            </span>
                        ` : ''}

                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="fw-bold mb-1" style="color: var(--primary-deep);">
                                ${need.title}
                            </h5>
                        </div>

                        <div class="d-flex align-items-center gap-2 mb-2">
                            <span class="category-badge">
                                ${getCategoryLabel(need.category)}
                            </span>
                            <span class="text-muted small">
                                <i class="fas fa-building ms-1"></i>
                                ${need.charity_name}
                            </span>
                        </div>

                        <div class="d-flex align-items-center gap-2 mb-2">
                            <i class="fas fa-map-marker-alt text-muted small"></i>
                            <span class="small text-muted">${need.city || need.province}</span>
                        </div>

                        <!-- ØªØ£ÛŒÛŒØ¯ÛŒÙ‡â€ŒÙ‡Ø§ -->
                        ${approvedVerifications.length > 0 ? `
                            <div class="verification-badges">
                                ${approvedVerifications.slice(0, 2).map(v => `
                                    <span class="verified-badge" title="ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ ØªÙˆØ³Ø· ${v.charity_name}">
                                        <i class="fas fa-check-circle"></i> ${v.charity_name}
                                    </span>
                                `).join('')}
                                ${approvedVerifications.length > 2 ? `
                                    <span class="verified-badge verified-badge-multiple">
                                        <i class="fas fa-ellipsis-h"></i> +${approvedVerifications.length - 2}
                                    </span>
                                ` : ''}
                            </div>
                        ` : `
                            <div class="verification-badges">
                                <span class="verified-badge verified-badge-pending">
                                    <i class="fas fa-clock"></i> Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯
                                </span>
                            </div>
                        `}

                        <!-- Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø±Ø¯Ø§Ø®Øª -->
                        <div class="need-progress">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <span class="text-muted small">Ù¾ÛŒØ´Ø±ÙØª Ú©Ù…Ú©â€ŒÙ‡Ø§</span>
                                <span class="fw-bold">${stats?.progress_percentage || need.percentage || 0}%</span>
                            </div>
                            <div class="progress-custom">
                                <div class="progress-bar-custom" style="width: ${stats?.progress_percentage || need.percentage || 0}%;"></div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <div>
                                    <small class="text-muted">Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡</small>
                                    <div class="need-amount">${formatNumber(need.collected_amount || 0)}</div>
                                </div>
                                <div class="text-start">
                                    <small class="text-muted">Ù‡Ø¯Ù</small>
                                    <div class="need-amount">${formatNumber(need.target_amount)}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Ø¢Ù…Ø§Ø± Ùˆ Ø¯Ú©Ù…Ù‡ Ú©Ù…Ú© -->
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <div class="d-flex align-items-center gap-2">
                                <span class="days-remaining ${daysClass}">
                                    <i class="fas fa-clock ms-1"></i>
                                    ${stats?.days_remaining ? `${stats.days_remaining} Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒ` : 'Ø¨Ø¯ÙˆÙ† Ù…Ù‡Ù„Øª'}
                                </span>
                                <span class="text-muted small">
                                    <i class="fas fa-eye ms-1"></i> ${need.view_count || 0}
                                </span>
                            </div>
                            <button class="btn btn-primary-charity rounded-pill px-4" onclick="viewNeed(${need.id})">
                                Ú©Ù…Ú© Ú©Ù†ÛŒØ¯
                                <i class="fas fa-arrow-left ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        container.innerHTML = html;
    }

    // ==================== 9ï¸âƒ£ Ø±Ù†Ø¯Ø± Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ (List View) ====================
    async function renderNeedsList(needs) {
        const container = document.getElementById('needsListContainer');
        const gridContainer = document.getElementById('needsGridContainer');

        if (!needs || needs.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-inbox"></i>
                    </div>
                    <h5 class="fw-bold mb-2">Ø¢Ú¯Ù‡ÛŒâ€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</h5>
                    <p class="text-muted">Ø¨Ø§ ØªØºÛŒÛŒØ± ÙÛŒÙ„ØªØ±Ù‡Ø§ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¬Ø³ØªØ¬Ùˆ Ú©Ù†ÛŒØ¯</p>
                </div>
            `;
            container.style.display = 'block';
            gridContainer.style.display = 'none';
            return;
        }

        let html = '';

        for (const need of needs) {
            const verifications = await loadNeedVerifications(need.id);
            const approvedVerifications = verifications.filter(v => v.status === 'approved');
            const stats = await loadNeedStats(need.id);
            const daysClass = stats?.days_remaining <= 5 ? 'urgent' : '';

            html += `
                <div class="need-list-item" data-aos="fade-up">
                    <div class="row align-items-center">
                        <div class="col-lg-5">
                            <div class="d-flex align-items-start gap-3">
                                ${need.is_emergency ? `
                                    <span class="badge bg-danger rounded-pill px-3 py-2">
                                        Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ
                                    </span>
                                ` : need.is_urgent ? `
                                    <span class="badge bg-warning rounded-pill px-3 py-2">
                                        ÙÙˆØ±ÛŒ
                                    </span>
                                ` : ''}
                                <div>
                                    <h5 class="fw-bold mb-2" style="color: var(--primary-deep);">
                                        <a href="/needs/${need.id}" class="text-decoration-none" style="color: inherit;">
                                            ${need.title}
                                        </a>
                                    </h5>
                                    <div class="d-flex flex-wrap gap-3">
                                        <span class="small text-muted">
                                            <i class="fas fa-building ms-1"></i>
                                            ${need.charity_name}
                                        </span>
                                        <span class="small text-muted">
                                            <i class="fas fa-map-marker-alt ms-1"></i>
                                            ${need.city || need.province}
                                        </span>
                                        <span class="small text-muted">
                                            <i class="fas fa-tag ms-1"></i>
                                            ${getCategoryLabel(need.category)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 mt-3 mt-lg-0">
                            <div class="d-flex align-items-center gap-3">
                                <div>
                                    <small class="text-muted">Ù¾ÛŒØ´Ø±ÙØª</small>
                                    <div class="fw-bold">${stats?.progress_percentage || need.percentage || 0}%</div>
                                </div>
                                <div>
                                    <small class="text-muted">Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø´Ø¯Ù‡</small>
                                    <div class="fw-bold" style="color: var(--primary-deep);">
                                        ${formatNumber(need.collected_amount || 0)}
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-2 mt-3 mt-lg-0">
                            <span class="days-remaining ${daysClass}">
                                <i class="fas fa-clock ms-1"></i>
                                ${stats?.days_remaining ? `${stats.days_remaining} Ø±ÙˆØ²` : 'Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯'}
                            </span>
                        </div>
                        <div class="col-lg-2 mt-3 mt-lg-0 text-start">
                            <button class="btn btn-primary-charity rounded-pill w-100" onclick="viewNeed(${need.id})">
                                Ú©Ù…Ú© Ú©Ù†ÛŒØ¯
                                <i class="fas fa-arrow-left ms-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        container.innerHTML = html;
        container.style.display = 'block';
        gridContainer.style.display = 'none';
    }

    // ==================== ğŸ”Ÿ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ ====================
    function renderPagination(totalPages, currentPage) {
        const container = document.getElementById('pagination');

        if (totalPages <= 1) {
            container.innerHTML = '';
            return;
        }

        let html = '';

        // Ø¯Ú©Ù…Ù‡ Ù‚Ø¨Ù„ÛŒ
        html += `
            <div class="page-item-custom ${currentPage === 1 ? 'disabled' : ''}"
                 onclick="${currentPage > 1 ? `loadNeeds(${currentPage - 1})` : ''}">
                <i class="fas fa-chevron-right"></i>
            </div>
        `;

        // ØµÙØ­Ù‡ Ø§ÙˆÙ„
        if (currentPage > 3) {
            html += `<div class="page-item-custom" onclick="loadNeeds(1)">1</div>`;
            if (currentPage > 4) {
                html += `<div class="page-item-custom disabled">...</div>`;
            }
        }

        // ØµÙØ­Ø§Øª Ø§Ø·Ø±Ø§Ù ØµÙØ­Ù‡ Ø¬Ø§Ø±ÛŒ
        for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
            html += `
                <div class="page-item-custom ${i === currentPage ? 'active' : ''}"
                     onclick="loadNeeds(${i})">
                    ${i}
                </div>
            `;
        }

        // ØµÙØ­Ù‡ Ø¢Ø®Ø±
        if (currentPage < totalPages - 2) {
            if (currentPage < totalPages - 3) {
                html += `<div class="page-item-custom disabled">...</div>`;
            }
            html += `<div class="page-item-custom" onclick="loadNeeds(${totalPages})">${totalPages}</div>`;
        }

        // Ø¯Ú©Ù…Ù‡ Ø¨Ø¹Ø¯ÛŒ
        html += `
            <div class="page-item-custom ${currentPage === totalPages ? 'disabled' : ''}"
                 onclick="${currentPage < totalPages ? `loadNeeds(${currentPage + 1})` : ''}">
                <i class="fas fa-chevron-left"></i>
            </div>
        `;

        container.innerHTML = html;
    }

    // ==================== 1ï¸âƒ£1ï¸âƒ£ ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
    function formatNumber(num) {
        if (!num) return 'Û°';
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    }

    function getCategoryLabel(category) {
        const labels = {
            'educational': 'ğŸ“š Ø¢Ù…ÙˆØ²Ø´ÛŒ',
            'health': 'ğŸ¥ Ø¯Ø±Ù…Ø§Ù†ÛŒ',
            'livelihood': 'ğŸ Ù…Ø¹ÛŒØ´ØªÛŒ',
            'dowry': 'ğŸ’ Ø¬Ù‡ÛŒØ²ÛŒÙ‡',
            'housing': 'ğŸ  Ù…Ø³Ú©Ù†',
            'emergency': 'ğŸš¨ Ø§Ø¶Ø·Ø±Ø§Ø±ÛŒ'
        };
        return labels[category] || category || 'Ø³Ø§ÛŒØ±';
    }

    function showLoading() {
        // Ø§Ø³Ú©Ù„ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¯Ø± HTML Ù‡Ø³ØªÙ†Ø¯
    }

    function hideLoading() {
        // Ø­Ø°Ù Ø§Ø³Ú©Ù„ØªÙˆÙ†â€ŒÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ø² Ù„ÙˆØ¯ Ø¯ÛŒØªØ§
        document.querySelectorAll('.skeleton-loading').forEach(el => el.remove());
    }

    function updateResultsCount(count) {
        document.getElementById('resultsCount').innerText = formatNumber(count);
    }

    function updateActiveFiltersCount() {
        let count = 0;
        Object.values(state.filters).forEach(value => {
            if (value !== null && value !== '' && value !== undefined && value !== false) {
                count++;
            }
        });

        // Ø­Ø°Ù ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶
        if (state.filters.sort_by === 'created_at' && state.filters.sort_order === 'desc') count--;

        state.activeFiltersCount = count;

        const badge = document.getElementById('activeFiltersBadge');
        const countSpan = document.getElementById('activeFiltersCount');

        if (count > 0) {
            countSpan.innerText = count;
            badge.style.display = 'inline-block';
        } else {
            badge.style.display = 'none';
        }
    }

    // ==================== 1ï¸âƒ£2ï¸âƒ£ Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ±Ù‡Ø§ ====================
    function applyFilters() {
        // Ø®ÙˆØ§Ù†Ø¯Ù† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø§Ø² ÙØ±Ù…
        state.filters.category = document.getElementById('categoryFilter').value || null;
        state.filters.province = document.getElementById('provinceFilter').value || null;
        state.filters.charity_id = document.getElementById('charityFilter').value || null;
        state.filters.search_text = document.getElementById('searchInput').value || null;

        // Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ
        const sortValue = document.getElementById('sortFilter').value;
        if (sortValue) {
            [state.filters.sort_by, state.filters.sort_order] = sortValue.split('.');
        }

        // ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡
        state.filters.min_amount = document.getElementById('minAmount').value || null;
        state.filters.max_amount = document.getElementById('maxAmount').value || null;
        state.filters.status = document.getElementById('statusFilter').value || null;

        const urgency = document.getElementById('urgencyFilter').value;
        state.filters.is_urgent = urgency === 'urgent';
        state.filters.is_emergency = urgency === 'emergency';

        state.filters.verified_only = document.getElementById('verifiedFilter').value === 'true';

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
        loadNeeds(1);
    }

    function resetFilters() {
        // Ø±ÛŒØ³Øª ÙØ±Ù…
        document.getElementById('categoryFilter').value = '';
        document.getElementById('provinceFilter').value = '';
        document.getElementById('charityFilter').value = '';
        document.getElementById('searchInput').value = '';
        document.getElementById('sortFilter').value = 'created_at.desc';
        document.getElementById('minAmount').value = '';
        document.getElementById('maxAmount').value = '';
        document.getElementById('statusFilter').value = '';
        document.getElementById('urgencyFilter').value = '';
        document.getElementById('verifiedFilter').value = '';
        document.getElementById('dateFrom').value = '';
        document.getElementById('dateTo').value = '';

        // Ø±ÛŒØ³Øª state
        state.filters = {
            sort_by: 'created_at',
            sort_order: 'desc'
        };

        // Ø¨Ø³ØªÙ† Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¬Ø³ØªØ¬Ùˆ
        document.getElementById('searchSuggestions').style.display = 'none';

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¬Ø¯Ø¯
        loadNeeds(1);
        showNotification('ÙÛŒÙ„ØªØ±Ù‡Ø§ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ Ø´Ø¯Ù†Ø¯', 'info');
    }

    function changePageSize() {
        state.pageSize = parseInt(document.getElementById('pageSizeSelect').value);
        loadNeeds(1);
    }

    function toggleViewMode(mode) {
        state.viewMode = mode;
        const gridView = document.getElementById('needsGridContainer');
        const listView = document.getElementById('needsListContainer');
        const toggleBtns = document.querySelectorAll('.view-toggle-btn');

        toggleBtns.forEach(btn => {
            btn.classList.remove('active');
        });

        if (mode === 'grid') {
            event.currentTarget.classList.add('active');
            gridView.style.display = 'flex';
            listView.style.display = 'none';
            loadNeeds(state.currentPage);
        } else {
            event.currentTarget.classList.add('active');
            gridView.style.display = 'none';
            listView.style.display = 'block';
            loadNeeds(state.currentPage);
        }
    }

    // ==================== 1ï¸âƒ£3ï¸âƒ£ Ø°Ø®ÛŒØ±Ù‡ Ø¬Ø³ØªØ¬Ùˆ ====================
    function saveSearchFilter() {
        new bootstrap.Modal(document.getElementById('saveSearchModal')).show();
    }

    function saveSearchFilterSubmit() {
        const name = document.getElementById('searchFilterName').value;
        if (!name) {
            showNotification('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… ÙÛŒÙ„ØªØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯', 'warning');
            return;
        }

        // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
        const savedSearches = JSON.parse(localStorage.getItem('savedSearches') || '[]');

        savedSearches.push({
            id: Date.now(),
            name: name,
            filters: { ...state.filters },
            notify: document.getElementById('autoNotify').checked,
            frequency: document.getElementById('notifyFrequency').value,
            created_at: new Date().toISOString()
        });

        localStorage.setItem('savedSearches', JSON.stringify(savedSearches));

        showNotification('ÙÛŒÙ„ØªØ± Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯', 'success');
        bootstrap.Modal.getInstance(document.getElementById('saveSearchModal')).hide();

        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙØ±Ù…
        document.getElementById('searchFilterName').value = '';
        document.getElementById('autoNotify').checked = false;
    }

    // ==================== 1ï¸âƒ£4ï¸âƒ£ ØªÙˆØ§Ø¨Ø¹ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª ====================
    function showLoginModal() {
        new bootstrap.Modal(document.getElementById('loginModal')).show();
    }

    async function handlePasswordLogin(event) {
        event.preventDefault();
        showNotification('Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...', 'info');

        // TODO: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ù„Ø§Ú¯ÛŒÙ†
        // const response = await api.post('/auth/login', { email, password });

        setTimeout(() => {
            showNotification('ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ² Ø¨ÙˆØ¯', 'success');
            bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
        }, 1500);
    }

    function sendOtp() {
        showNotification('Ú©Ø¯ ØªØ£ÛŒÛŒØ¯ Ø¨Ù‡ Ø´Ù…Ø§Ø±Ù‡ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯', 'success');
    }

    function handleGoogleLogin() {
        showNotification('Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú¯ÙˆÚ¯Ù„...', 'info');
    }

    // ==================== 1ï¸âƒ£5ï¸âƒ£ Ø³Ø§ÛŒØ± ØªÙˆØ§Ø¨Ø¹ ====================
    function viewNeed(id) {
        window.location.href = `/needs/${id}`;
    }

    function showNotification(message, type = 'success') {
        Toastify({
            text: message,
            duration: 3000,
            gravity: "bottom",
            position: "right",
            backgroundColor: type === 'success' ? 'linear-gradient(135deg, #10b981, #059669)' :
                           type === 'error' ? 'linear-gradient(135deg, #ef4444, #dc2626)' :
                           type === 'warning' ? 'linear-gradient(135deg, #f59e0b, #d97706)' :
                           'linear-gradient(135deg, #3b82f6, #2563eb)',
            className: "rounded-pill px-4 py-2",
            close: true
        }).showToast();
    }

    // ==================== Ù…Ù‚Ø¯Ø§Ø±Ø¯Ù‡ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ====================
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
            easing: 'ease-in-out'
        });

        // Initialize Select2
        $('.form-select').select2({
            language: 'fa',
            minimumResultsForSearch: 10,
            width: '100%'
        });

        // Initialize Persian Datepicker
        $('.datepicker').persianDatepicker({
            format: 'YYYY/MM/DD',
            autoClose: true,
            initialValueType: 'gregorian',
            calendar: {
                persian: {
                    locale: 'fa'
                }
            }
        });

        // Load initial data
        loadNeedsStats();
        loadCharities();
        loadProvinces();
        loadNeeds(1);

        // Click outside to close suggestions
        document.addEventListener('click', function(event) {
            const suggestions = document.getElementById('searchSuggestions');
            if (!event.target.closest('#searchSuggestions') && !event.target.closest('#searchInput')) {
                suggestions.style.display = 'none';
            }
        });

        // Close suggestions on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.getElementById('searchSuggestions').style.display = 'none';
            }
        });

        // Load saved searches count
        const savedSearches = JSON.parse(localStorage.getItem('savedSearches') || '[]');
        if (savedSearches.length > 0) {
            // Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ ÛŒÚ© Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† Ù†Ù…Ø§ÛŒØ´ Ø¯Ù‡ÛŒØ¯
        }
    });
</script>

</body>
</html>